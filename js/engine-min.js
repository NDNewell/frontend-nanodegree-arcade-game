var Engine=function(e){function l(){function e(){stopGame?winGame?p():goUplevel?m():pause?o():beginGame?s():r():S.requestAnimationFrame(l)}var t=Date.now(),i=(t-x)/1e3;a(i),n(),x=t,e(),stopGame&&gameMusicSound.pause()}function t(){x=Date.now(),l()}function a(e){i(e),u()}function i(e){allEnemies.forEach(function(l){l.update(e),l.collisions()}),allRelics.forEach(function(l){l.update(e),l.collisions()}),player.update()}function n(){var e,l,t=["images/water-block.png","images/stone-block.png","images/stone-block.png","images/stone-block.png","images/stone-block.png","images/grass-block.png","images/grass-block.png"],a=7,i=5;for(e=0;a>e;e++)for(l=0;i>l;l++)d.drawImage(Resources.get(t[e]),101*l,83*e);g(),f(),c()}function g(){allRelics.forEach(function(e){e.render()}),allEnemies.forEach(function(e){e.render()}),player.render()}function s(){d.rect(40,75,430,590),d.fillStyle="rgba(0,0,0,0.75)",d.fill(),d.font="60px Impact",d.fillStyle="Yellow",d.fillText("CARTMAN CRUSH",55,145),d.font="32px Impact",d.fillText("Press the Spacebar to begin!",65,650),d.font="25px Impact",d.fillStyle="#7ACC52",d.fillText("Cartman must reach the water 3 times",55,185),d.fillText("to pass each level. There are 4 levels.",55,215),d.fillText("Avoid the bugs:",55,265),d.fillText("Try to obtain the following items:",55,310),d.fillStyle="orange",d.fillText("500 pts",145,365),d.fillText("300 pts",145,445),d.fillText("100 pts",145,525),d.fillText("Pass Level",335,365),d.fillText("Extra life",335,445),d.fillText("Invincibility",335,525),d.fillText("Every 1000 pts = 1 extra life.",120,575),d.fillText("Press 'P' to Pause the Game",120,610),d.drawImage(Resources.get("images/enemy-bug-begin.png"),230,200),d.drawImage(Resources.get("images/enemy-bug2-begin.png"),300,200),d.drawImage(Resources.get("images/enemy-bug3-begin.png"),370,200),d.drawImage(Resources.get("images/Gem-Green-sm.png"),65,300),d.drawImage(Resources.get("images/Gem-Orange-sm.png"),65,380),d.drawImage(Resources.get("images/Gem-Blue-sm.png"),65,460),d.drawImage(Resources.get("images/Key.png"),255,300),d.drawImage(Resources.get("images/Heart.png"),255,370),d.drawImage(Resources.get("images/Star.png"),255,460)}function r(){d.rect(40,100,430,150),d.fillStyle="rgba(0,0,0,0.75)",d.fill(),d.font="60px Impact",d.fillStyle="yellow",d.fillText("GAME OVER",125,170),d.font="30px Impact",d.fillStyle="#7ACC52",d.fillText("Press the Spacebar to Play Again",55,225)}function o(){d.rect(40,100,430,150),d.fillStyle="rgba(0,0,0,0.75)",d.fill(),d.font="60px Impact",d.fillStyle="yellow",d.fillText("PAUSED",165,190)}function p(){d.rect(40,100,430,150),d.fillStyle="rgba(0,0,0,0.75)",d.fill(),d.font="60px Impact",d.fillStyle="yellow",d.fillText("YOU WIN!",145,170),d.font="30px Impact",d.fillStyle="#7ACC52",d.fillText("Press the Spacebar to Play Again",55,225)}function m(){d.rect(40,100,430,300),d.fillStyle="rgba(0,0,0,0.75)",d.fill();var e=player.level-1;d.font="50px Impact",d.fillStyle="yellow",d.fillText("YOU PASSED LEVEL",80,170),d.font="80px Impact",d.fillText(e,235,260),d.font="40px Impact",d.fillStyle="#7ACC52",d.fillText("Press the Spacebar",95,320),d.font="40px Impact",4===player.level?d.fillText("for the FINAL level !",110,365):d.fillText("for the next level !",110,365)}function f(){var e=45;d.font="35px Impact",d.fillStyle="#70B8FF",d.fillText("LIVES: "+player.lives,10,e),d.fillStyle="#7ACC52",d.fillText("POINTS: "+player.points,175,e),d.fillStyle="orange",5===player.level?d.fillText("WINNER",385,e):d.fillText("LEVEL: "+player.level,385,e)}function c(){starPower&&(d.font="35px Impact",d.fillStyle="Yellow",d.fillStroke="black",d.lineWidth=1,d.fillText(starTime,player.x+75,player.y+190),d.strokeText(starTime,player.x+75,player.y+190)),getGem&&(d.font="30px Impact",d.fillStyle="white",d.fillStroke="black",d.lineWidth=1,d.fillText(gemValue,player.x+30,player.y),d.strokeText(gemValue,player.x+30,player.y))}function u(){d.clearRect(0,0,T.width,50)}function y(){d.clearRect(0,0,T.width,T.height)}var x,b=e.document,S=e.window,T=b.createElement("canvas"),d=T.getContext("2d");T.width=505,T.height=675,b.body.appendChild(T),Resources.load(["images/stone-block.png","images/water-block.png","images/grass-block.png","images/enemy-bug.png","images/enemy-bug2.png","images/enemy-bug3.png","images/char-cartman.png","images/Gem-Blue-sm.png","images/Gem-Orange-sm.png","images/Gem-Green-sm.png","images/Key.png","images/Heart.png","images/Star.png","images/char-cartman-wizard.png","images/enemy-bug-begin.png","images/enemy-bug2-begin.png","images/enemy-bug3-begin.png"]),Resources.onReady(t),reset=function(){(0===player.lives||winGame)&&(player.lives=3,player.level=1,player.touchWater=0,player.points=0,restartPlayer()),adjustSpeed=!0,pause=!1,stopGame=!1,goUplevel=!1,beginGame=!1,winGame=!1,introMusicSound.pause(),gameMusicSound.play(),gameMusicSound.loop=!0,y(),d.beginPath(),l()},e.ctx=d}(this);